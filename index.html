<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizzatore e Aggiornatore Foglio di Calcolo</title>
    <!-- Carica l'API di Google -->
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        body {
            background-color: white; /* Imposta il background arancione */
            color: black; /* Imposta il colore del testo nero */
            font-family: Arial, sans-serif; /* Imposta il font del testo */
            margin: 0; /* Rimuove il margine predefinito */
            padding: 20px; /* Aggiunge spazio interno */
        }
        h1 {
            text-align: center;
            margin-top: 20px;
        }
        #logo {
            width: auto; /* Imposta la larghezza del logo */
            height: auto; /* Imposta l'altezza in base alla larghezza mantenendo l'aspect ratio */
            display: block; /* Imposta il logo come blocco per centrarlo facilmente */
            margin: 0 auto; /* Centra il logo orizzontalmente */
        }
        table {
            width: 100%; /* Imposta la larghezza della tabella al 100% */
            border-collapse: collapse; /* Unisce i bordi delle celle */
            background-color: white; /* Imposta lo sfondo della tabella bianco */
            margin-top: 20px; /* Aggiunge spazio superiore */
        }
        th, td {
            border: 1px solid black; /* Aggiunge bordi a celle e intestazioni */
            padding: 8px; /* Aggiunge spazio interno alle celle */
            text-align: left; /* Allinea il testo a sinistra */
        }
        .non-empty {
            background-color: #db7093; /* Colora il contenuto non vuoto */
        }
        .empty{
            background-color: #8fbc8f; /* Colora il contenuto vuoto */
        }
    </style>
</head>
<body>
    <img id="logo" src="logo.png" alt="Logo">
    <h1>Prenotazione BIA 13</h1>
    <table id="schedule">
        <!-- Qui verrà generata la tabella degli orari e dei giorni -->
    </table>
    <table id="spreadsheet-data">
        <!-- Qui verranno inseriti i dati del foglio di calcolo -->
    </table>
    <script>

// Funzione per caricare la tabella degli orari e dei giorni
function loadScheduleTable() {
    const table = document.getElementById('schedule');
    table.innerHTML = ''; // Pulisce la tabella

    const days = getDaysInRange(new Date('2024-02-01'), new Date('2024-04-30')); // Ottieni i giorni da febbraio ad aprile
    const times = generateTimeSlots(); // Genera gli slot di tempo da 09:00 a 20:15 a intervalli di 15 minuti

    // Crea l'intestazione delle colonne con i giorni
    const headerRow = document.createElement('tr');
    const emptyHeaderCell = document.createElement('th');
    headerRow.appendChild(emptyHeaderCell); // Cella vuota per l'angolo in alto a sinistra
    days.forEach(day => {
        const dayCell = document.createElement('th');
        dayCell.textContent = day.toLocaleDateString('it-IT', { day: '2-digit', month: '2-digit' }); // Visualizza solo il giorno e il mese
        headerRow.appendChild(dayCell);
    });
    table.appendChild(headerRow);

    // Crea le righe con gli orari
    times.forEach(time => {
        const row = document.createElement('tr');
        const timeCell = document.createElement('td');
        timeCell.textContent = time;
        row.appendChild(timeCell); // Aggiungi l'orario nella prima colonna
        days.forEach(() => {
            const timeSlotCell = document.createElement('td');
            timeSlotCell.contentEditable = true; // Imposta la cella come editabile
            timeSlotCell.addEventListener('input', function() {
                if (this.textContent.trim() === '') {
                    this.style.backgroundColor = 'white'; // Imposta lo sfondo verde se la cella è vuota
                } else {
                    this.style.backgroundColor = '#db7093'; // Altrimenti, imposta lo sfondo rosso
                }
            });
            // Puoi aggiungere ulteriori personalizzazioni qui, ad esempio input per gli appuntamenti
            row.appendChild(timeSlotCell);
        });
        table.appendChild(row);
    });
}

// Funzione per generare gli slot di tempo da 09:00 a 20:15 a intervalli di 15 minuti
function generateTimeSlots() {
    const times = [];
    let current = new Date('2024-01-01T09:00:00');
    const end = new Date('2024-01-01T20:15:00');
    while (current <= end) {
        times.push(current.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' }));
        current = new Date(current.getTime() + 15 * 60000); // Aggiungi 15 minuti
    }
    return times;
}

// Funzione per ottenere i giorni in un intervallo di date
function getDaysInRange(startDate, endDate) {
    const days = [];
    let currentDate = new Date(startDate);
    while (currentDate <= endDate) {
        days.push(new Date(currentDate));
        currentDate.setDate(currentDate.getDate() + 1); // Incrementa di un giorno
    }
    return days;
}

// Chiamata alla funzione per caricare la tabella degli orari e dei giorni
loadScheduleTable();

        
        // ID del foglio di calcolo condiviso
        const SPREADSHEET_ID = '1f0LTsDeHUTE-pVmqgYqpwFVc1AFk94_0yGDKF4wnHsE';
        // ID della tabella nel foglio di calcolo (di solito 0)
        const SHEET_ID = 0;

        // Funzione per caricare i dati del foglio di calcolo
        function loadSpreadsheetData() {
            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: SPREADSHEET_ID,
                range: 'FEBBRAIO' // Cambia "Sheet1" con il nome del tuo foglio di lavoro se è diverso
            }).then(response => {
                const values = response.result.values;
                const table = document.getElementById('spreadsheet-data');
                table.innerHTML = '';

                if (values && values.length > 0) {
                    values.forEach((row, rowIndex) => {
                        const tr = document.createElement('tr');
                        row.forEach((cell, columnIndex) => {
                            const td = document.createElement('td');
                            td.textContent = cell;
                            td.contentEditable = true; // Permette la modifica del contenuto
                            td.dataset.row = rowIndex;
                            td.dataset.column = columnIndex;
                            if (cell.trim() !== '') {
                                td.classList.add('non-empty'); // Aggiunge la classe 'non-empty'
                            }
                            if (cell.trim() == '') {
                                td.classList.add('empty'); // Aggiunge la classe 'empty'
                            }
                            td.addEventListener('blur', function() {
                                const row = parseInt(this.dataset.row);
                                const column = parseInt(this.dataset.column);
                                const newValue = this.textContent;
                                updateCellValue(row, column, newValue);
                            });
                            tr.appendChild(td);
                        });
                        table.appendChild(tr);
                    });
                } else {
                    console.log('Nessun dato trovato.');
                }
            }, error => {
                console.error('Errore nel caricamento dei dati del foglio di calcolo:', error.result.error.message);
            });
        }
// Funzione per aggiornare il valore di una cella nel foglio di calcolo
        function updateCellValue(row, column, newValue) {
            gapi.client.sheets.spreadsheets.values.update({
                spreadsheetId: SPREADSHEET_ID,
                range: 'FEBBRAIO!' + String.fromCharCode(65 + column) + (row + 1), // Converti la coordinata della cella in formato A1
                valueInputOption: 'RAW',
                resource: { values: [[newValue]] }
            }).then(response => {
                console.log('Cella aggiornata con successo.');
            }, error => {
                console.error('Errore nell\'aggiornamento della cella:', error.result.error.message);
            });
        }
         // Funzione per aggiornare il foglio di calcolo con i valori modificati nella tabella
        function updateSpreadsheet() {
            const table = document.getElementById('spreadsheet-data');
            const cells = table.querySelectorAll('td');

            cells.forEach(cell => {
                cell.addEventListener('blur', () => {
                    const row = parseInt(cell.dataset.row);
                    const column = parseInt(cell.dataset.column);
                    const newValue = cell.textContent;
                    updateCellValue(row, column, newValue);
                });
            });
        }

        // Inizializzazione dell'API di Google Sheets
        function initClient() {
            gapi.client.init({
                apiKey: 'AIzaSyBkOe-zFT15kggPuwA6yFG5bL_Wcl29nT8',
                discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest'],
            }).then(() => {
                loadSpreadsheetData(); // Carica i dati del foglio di calcolo all'inizializzazione
            }, error => {
                console.error(`Errore nell'inizializzazione del client Google Sheets API: ${error}`);
            });
        }

        // Carica il client dell'API di Google Sheets
        gapi.load('client', initClient);
    </script>

    
</body>
</html>
