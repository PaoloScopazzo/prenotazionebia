<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizzatore e Aggiornatore Foglio di Calcolo</title>
    <!-- Carica l'API di Google -->
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        body {
            background-color: orange; /* Imposta il background arancione */
            color: black; /* Imposta il colore del testo nero */
            font-family: Arial, sans-serif; /* Imposta il font del testo */
            margin: 0; /* Rimuove il margine predefinito */
            padding: 20px; /* Aggiunge spazio interno */
        }
        h1 {
            text-align: center;
            margin-top: 20px;
        }
        table {
            width: 100%; /* Imposta la larghezza della tabella al 100% */
            border-collapse: collapse; /* Unisce i bordi delle celle */
            background-color: white; /* Imposta lo sfondo della tabella bianco */
            margin-top: 20px; /* Aggiunge spazio superiore */
        }
        th, td {
            border: 1px solid black; /* Aggiunge bordi a celle e intestazioni */
            padding: 8px; /* Aggiunge spazio interno alle celle */
            text-align: left; /* Allinea il testo a sinistra */
        }
        .non-empty {
            background-color: green; /* Colora il contenuto non vuoto di verde */
        }
    </style>
</head>
<body>
    <h1>Prenotazione BIA 6</h1>
    <table id="spreadsheet-data">
        <!-- Qui verranno inseriti i dati del foglio di calcolo -->
    </table>
    <script>
        // ID del foglio di calcolo condiviso
        const SPREADSHEET_ID = '1f0LTsDeHUTE-pVmqgYqpwFVc1AFk94_0yGDKF4wnHsE';
        // ID della tabella nel foglio di calcolo (di solito 0)
        const SHEET_ID = 0;

function loadSpreadsheetData() {
    gapi.client.sheets.spreadsheets.get({
        spreadsheetId: SPREADSHEET_ID
    }).then(response => {
        const sheets = response.result.sheets;
        sheets.forEach(sheet => {
            const table = document.createElement('table');
            table.innerHTML = `<caption>${sheet.properties.title}</caption>`;
            const sheetId = sheet.properties.sheetId;
            gapi.client.sheets.spreadsheets.get({
                spreadsheetId: SPREADSHEET_ID,
                ranges: [`${sheet.properties.title}!A1:Z100`],
                fields: 'sheets(properties,sheetId,data.rowData.values.userEnteredFormat.backgroundColor)',
            }).then(response => {
                const sheetData = response.result.sheets.find(sheet => sheet.properties.sheetId === sheetId);
                if (sheetData && sheetData.data && sheetData.data.length > 0) {
                    const rowData = sheetData.data[0].rowData;
                    rowData.forEach((row, rowIndex) => {
                        const tr = document.createElement('tr');
                        if (row.values) {
                            row.values.forEach((cell, columnIndex) => {
                                const td = document.createElement('td');
                                td.textContent = cell.userEnteredValue ? cell.userEnteredValue.stringValue : '';
                                td.contentEditable = true; // Permette la modifica del contenuto
                                td.dataset.row = rowIndex;
                                td.dataset.column = columnIndex;
                                if (cell.userEnteredFormat && cell.userEnteredFormat.backgroundColor) {
                                    td.style.backgroundColor = cell.userEnteredFormat.backgroundColor;
                                }
                                td.addEventListener('blur', function() {
                                    const row = parseInt(this.dataset.row);
                                    const column = parseInt(this.dataset.column);
                                    const newValue = this.textContent;
                                    updateCellValue(row, column, newValue);
                                });
                                tr.appendChild(td);
                            });
                        }
                        table.appendChild(tr);
                    });
                } else {
                    console.log('Nessun dato trovato.');
                }
                document.body.appendChild(table);
            }, error => {
                console.error('Errore nel caricamento dei dati del foglio di calcolo:', error.result.error.message);
            });
        });
    }, error => {
        console.error('Errore nel caricamento del foglio di calcolo:', error.result.error.message);
    });
}



        
// Funzione per aggiornare il valore di una cella nel foglio di calcolo
        function updateCellValue(row, column, newValue) {
            gapi.client.sheets.spreadsheets.values.update({
                spreadsheetId: SPREADSHEET_ID,
                range: 'FEBBRAIO!' + String.fromCharCode(65 + column) + (row + 1), // Converti la coordinata della cella in formato A1
                valueInputOption: 'RAW',
                resource: { values: [[newValue]] }
            }).then(response => {
                console.log('Cella aggiornata con successo.');
            }, error => {
                console.error('Errore nell\'aggiornamento della cella:', error.result.error.message);
            });
        }
         // Funzione per aggiornare il foglio di calcolo con i valori modificati nella tabella
        function updateSpreadsheet() {
            const table = document.getElementById('spreadsheet-data');
            const cells = table.querySelectorAll('td');

            cells.forEach(cell => {
                cell.addEventListener('blur', () => {
                    const row = parseInt(cell.dataset.row);
                    const column = parseInt(cell.dataset.column);
                    const newValue = cell.textContent;
                    updateCellValue(row, column, newValue);
                });
            });
        }

        // Inizializzazione dell'API di Google Sheets
        function initClient() {
            gapi.client.init({
                apiKey: 'AIzaSyBkOe-zFT15kggPuwA6yFG5bL_Wcl29nT8',
                discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest'],
            }).then(() => {
                loadSpreadsheetData(); // Carica i dati del foglio di calcolo all'inizializzazione
            }, error => {
                console.error(`Errore nell'inizializzazione del client Google Sheets API: ${error}`);
            });
        }

        // Carica il client dell'API di Google Sheets
        gapi.load('client', initClient);
    </script>

    
</body>
</html>
